module symb3j0
#using SpecialFunctions
"""squared 3j symbol for integer arguments
      l1  l2  l3 
    (           )^2
      0    0   0 
"""
function sym3j2(l1, l2, l3)
    function logfactorial(n::Integer) 
        res = 0e0
        for kk=1:n
            res += log(kk)
        end
        res
    end
    J = l1 + l2 + l3
    if J % 2 != 0  || l3>l1+l2  || l2>l1+l3 || l1>l2+l3
        return 0e0
    end
    C = sum([logfactorial(J-2c) for c in [l1, l2, l3]])
    C -= logfactorial(J+1)
    D = logfactorial(Integer(J/2)) -  sum([logfactorial(Integer(J/2)-c) for c in [l1, l2, l3]])
    exp(C + 2D)
end

"""squared 3j symbol 
     j1   j2   k
    (           )^2
     1/2  -1/2 0
takes doubled values of j1, j2, k as arguments.
Tabulated values were computed with WignerSymbols package
"""
function gam2s(j1, j2, k)
    global GamCoefs
    @assert 0<j1<23 && j1 % 2 == 1
    @assert 0<j2<23 && j2 % 2 == 1 
    jl, jg = min(j1, j2), max(j1, j2)
    if !(jg-jl<=k<=jg+jl) 
        return 0e0
    end
    ii = 1; ki = div((j1-1)^2, 2) + (j2-1) + div(k-j1+j2, 2) + 1
    return GamCoefs[ki]
    for jt1=1:2:21
        for jt2=1:2:jt1
            for kt = jt1-jt2:2:jt1+jt2
                if jg==jt1 && jl==jt2 && kt==k
                    return GamCoefs[ii]
                end
                ii+=1
            end
        end
    end
    error("$j1 $j2 $k not found in table")
end

const GamCoefs = Float64[0.5, 0.16666666666666666, 0.16666666666666666, 0.1, 0.25,
0.016666666666666666, 0.05, 0.06428571428571428, 0.1, 0.07142857142857142, 0.1, 0.014285714285714285,
0.02857142857142857, 0.047619047619047616, 0.16666666666666666, 0.004761904761904762, 0.0380952380952381, 0.012698412698412698,
0.015873015873015872, 0.03607503607503607, 0.07142857142857142, 0.05555555555555555, 0.06428571428571428, 0.011904761904761904,
0.01984126984126984, 0.03787878787878788, 0.07142857142857142, 0.004761904761904762, 0.023809523809523808,
0.010822510822510822, 0.010822510822510822, 0.029137529137529136, 0.125, 0.001984126984126984,
0.02976190476190476, 0.00487012987012987, 0.01461038961038961, 0.009365634365634366, 0.007284382284382284,
0.023795648795648796, 0.05555555555555555, 0.045454545454545456, 0.047619047619047616,
0.010101010101010102, 0.015151515151515152, 0.03146853146853147, 0.047619047619047616,
0.004329004329004329, 0.017316017316017316, 0.009324009324009324, 0.008158508158508158,
0.024475524475524476, 0.05555555555555555, 0.0021645021645021645, 0.01948051948051948,
0.004495504495504496, 0.01048951048951049, 0.008158508158508158, 0.005439005439005439,
0.020156314273961334, 0.1, 0.00101010101010101, 0.024242424242424242, 0.0023976023976023976,
0.012587412587412588, 0.004195804195804196, 0.007459207459207459, 0.0071666895196306965,
0.004031262854792266, 0.01718591006516703, 0.045454545454545456, 0.038461538461538464,
0.03787878787878788, 0.008741258741258742, 0.012237762237762238, 0.026923076923076925,
0.03607503607503607, 0.003885003885003885, 0.013597513597513598, 0.008158508158508158,
0.006526806526806527, 0.021116138763197588, 0.03787878787878788, 0.0020812520812520815,
0.014568764568764568, 0.004079254079254079, 0.008158508158508158, 0.007198683669271904,
0.0043192102015631425, 0.01750416765896642, 0.045454545454545456, 0.0011655011655011655,
0.016317016317016316, 0.002331002331002331, 0.009324009324009324, 0.0038392979569450156,
0.005758946935417524, 0.0063651518759877896, 0.0031825759379938948, 0.015003572279114075,
0.08333333333333333, 0.0005827505827505828, 0.020396270396270396, 0.0013597513597513598,
0.010878010878010878, 0.0022852964029434616, 0.006855889208830386, 0.0035361954866598828,
0.0044202443583248536, 0.0056831713178462405, 0.0025005953798523457, 0.013155306128788428,
0.038461538461538464, 0.03333333333333333, 0.03146853146853147, 0.007692307692307693, 0.010256410256410256,
0.023529411764705882, 0.029137529137529136, 0.0034965034965034965, 0.011188811188811189,
0.007239819004524887, 0.005429864253393665, 0.018575851393188854, 0.029137529137529136,
0.0019425019425019425, 0.011655011655011656, 0.003702180172768408, 0.006663924310983134,
0.006430102405334604, 0.00357227911407478, 0.015479876160990712, 0.03146853146853147,
0.0011655011655011655, 0.012432012432012432, 0.0021938845468257233, 0.007404360345536816,
0.0035073285847279654, 0.0046764381129706205, 0.0057156465825196475, 0.002619671350321505,
0.013326154260331135, 0.038461538461538464, 0.0006993006993006993, 0.013986013986013986,
0.001371177841766077, 0.008227067050596462, 0.002165017644893806, 0.005412544112234515,
0.003247526467340709, 0.00357227911407478, 0.005125443946281206, 0.002050177578512482,
0.011727015749091399, 0.07142857142857142, 0.0003663003663003663, 0.017582417582417582,
0.0008462126109184933, 0.00951989187283305, 0.0013917970574317323, 0.006185764699696588,
0.0020619215665655293, 0.004252713231041405, 0.00299538931925525, 0.00287557374648504, 0.004639258977662531,
0.001675287964155914, 0.010486061701568499, 0.03333333333333333, 0.029411764705882353,
0.026923076923076925, 0.006862745098039216, 0.008823529411764706, 0.02089783281733746,
0.024475524475524476, 0.003167420814479638, 0.009502262443438913, 0.006501547987616099,
0.0046439628482972135, 0.016585581601061477, 0.023795648795648796, 0.001799670917317976,
0.009718222953517071, 0.003375803762800667, 0.005626339604667778, 0.005804953560371517,
0.003040689960194604, 0.013881410687844932, 0.024475524475524476, 0.0011197952374422963,
0.010078157136980667, 0.0020459416744246467, 0.00613782502327394, 0.003215051202667302,
0.003929507025482257, 0.005182393323462108, 0.0022210257100551893, 0.011993538834298021,
0.026923076923076925, 0.0007198683669271905, 0.010798025503907857, 0.0013260733074974562,
0.006630366537487281, 0.002029704042087943, 0.004465348892593475, 0.00298984230199737, 0.00298984230199737,
0.0046641539911158976, 0.0017324000538430475, 0.010586889217929735, 0.03333333333333333,
0.00045248868778280545, 0.012217194570135747, 0.0008768321461819913, 0.007306934551516595,
0.0013531360280586288, 0.004961498769548305, 0.0019414560402580324, 0.0034946208724644582,
0.002767739730991851, 0.0023987077668596044, 0.004234755687171894, 0.001411585229057298,
0.009491693781592175, 0.0625, 0.00024509803921568627, 0.015441176470588236, 0.0005626339604667778,
0.008439509407001666, 0.0009133668189395743, 0.005581686115741843, 0.0013212686940644943,
0.003963806082193483, 0.0018346759580438407, 0.0028620944945483913, 0.0025652846951137436,
0.0019952214295329116, 0.0038757749608168053, 0.001186461722699022, 0.008611415729267095,
0.029411764705882353, 0.02631578947368421, 0.023529411764705882, 0.006191950464396285,
0.007739938080495356, 0.018796992481203006, 0.021116138763197588, 0.002889576883384933,
0.008255933952528379, 0.005897095680377414, 0.004054253280259473, 0.014983109948785007,
0.020156314273961334, 0.0016670635865682305, 0.008335317932841153, 0.0030959752321981426,
0.004865103936311367, 0.005288156452512355, 0.0026440782262561776, 0.012585812356979404,
0.020156314273961334, 0.0010608586459979648, 0.008486869167983718, 0.0019052155275065491,
0.00523934270064301, 0.002961367613406919, 0.0033844201296079073, 0.00473818818145107,
0.0019248889487144972, 0.010907704042715485, 0.021116138763197588, 0.0007072390973319766,
0.008840488716649707, 0.0012629269595213868, 0.005556878621894102, 0.0018983125726967428,
0.0037966251453934855, 0.0027639431058464575, 0.0025665185982859965, 0.004277530997143327,
0.0014971358490001646, 0.009653944957345888, 0.023529411764705882, 0.0004763038818766373,
0.009526077637532746, 0.0008660070579575224, 0.005953798523457966, 0.0012943040268386882,
0.004141772885883802, 0.0018223800697888732, 0.002961367613406919, 0.0025665185982859965,
0.002053214878628797, 0.003894028218089098, 0.001216883818152843, 0.008675203993928333,
0.029411764705882353, 0.00030959752321981426, 0.010835913312693499, 0.0005953798523457966,
0.006549178375803763, 0.0009060128187870818, 0.004530064093935409, 0.0012684179463019146,
0.003297886660384978, 0.001727464441154036, 0.0024184502176156503, 0.0023850922835795723,
0.0017036373454139802, 0.0035721428210293135, 0.0010206122345798039, 0.007886549085389393,
0.05555555555555555, 0.0001719986240110079, 0.013759889920880633, 0.0003931397120251609,
0.007567939456484348, 0.000632770857565581, 0.005062166860524648, 0.0009019860951480281,
0.0036643185115388644, 0.001221439503846288, 0.0027360244886156853, 0.001630832330652699,
0.002038540413315874, 0.002222666644196017, 0.0014515374002912766, 0.0032989486370256288,
0.0008762832317099327, 0.007235595827547729, 0.02631578947368421, 0.023809523809523808, 0.02089783281733746,
0.005639097744360902, 0.006892230576441102, 0.017080745341614908, 0.018575851393188854,
0.0026536930561698365, 0.00729765590446705, 0.005393919581562602, 0.0035959463877084014,
0.013664596273291925, 0.01750416765896642, 0.0015479876160990713, 0.00729765590446705,
0.002855604484356672, 0.0042834067265350075, 0.004854527623406342, 0.0023373651520104607,
0.011513687600644123, 0.01718591006516703, 0.0010002381519409382, 0.007335079780900215,
0.0017768205680441513, 0.004568967174970674, 0.002741380304982405, 0.0029698286637309386,
0.004363081617086193, 0.0016967539622001866, 0.010004997501249375, 0.01750416765896642,
0.0006819805581415488, 0.007501786139557038, 0.001195936920798948, 0.004783747683195792,
0.0017768205680441513, 0.0032998096263677098, 0.0025665185982859965, 0.002245703773500247,
0.003949341118914227, 0.0013164470396380757, 0.008875401009172832, 0.018575851393188854,
0.0004763038818766373, 0.007859014050964515, 0.00083870900939147, 0.0050322540563488205,
0.0012301065471074894, 0.0035536411360883027, 0.0017110123988573309, 0.0025665185982859965,
0.002389517315645583, 0.001792137986734187, 0.0036035462744009998, 0.0010677174146373333,
0.007991703073194585, 0.02089783281733746, 0.00033171163202122956, 0.008513931888544891,
0.000597968460399474, 0.005381716143595266, 0.0008806444598610435, 0.0038161259927311886,
0.0012092251088078251, 0.0028215252538849253, 0.0016261992842587995, 0.002090827651189885,
0.0022257197577182646, 0.0014838131718121763, 0.0033123506158635454, 0.0008938088963441312,
0.007278158155945069, 0.02631578947368421, 0.00022114108801415304, 0.009730207872622734,
0.0004230525162009884, 0.005922735226813838, 0.0006378330244261056, 0.004145914658769686,
0.0008794364427693274, 0.003078027549692646, 0.0011675276912627278, 0.0023350553825254557,
0.0015387692152126274, 0.0017585933888144313, 0.0020783376413261462, 0.001261847853662303,
0.0030644876446084502, 0.0007661219111521126, 0.006688037224381955, 0.05, 0.00012531328320802005,
0.012406015037593985, 0.00028556044843566715, 0.006853450762456012, 0.0004568967174970675,
0.004619733476914793, 0.0006449200580308401, 0.0033858303046619105, 0.0008597249362934632,
0.0025791748088803894, 0.0011185668525968715, 0.0019885632935055493, 0.0014548363489283022,
0.0015142174243947635, 0.0019468509742218388, 0.0010951036729997844, 0.002851215869341781,
0.0006688037224381956, 0.0061907216359022715, 0.023809523809523808, 0.021739130434782608,
0.018796992481203006, 0.005175983436853002, 0.006211180124223602, 0.01565217391304348,
0.016585581601061477, 0.0024517816279830008, 0.006538084341288003, 0.004968944099378882,
0.003229813664596273, 0.012560386473429951, 0.015479876160990712, 0.0014422244870488242,
0.006490010191719709, 0.002647924158221641, 0.0038247793396534815, 0.004485852311939268,
0.0020933977455716585, 0.01061136098617358, 0.015003572279114075, 0.000942253331538565,
0.006461165701978732, 0.0016614426090802454, 0.004049766359633098, 0.002549852893102321,
0.0026442918891431476, 0.00404242323282803, 0.0015159087123105114, 0.009242153116989893,
0.015003572279114075, 0.0006523292295266989, 0.006523292295266989, 0.001130703997846278,
0.0041997577062861755, 0.0016665705183675301, 0.0029164984071431777, 0.0023935400720692286,
0.001994616726724357, 0.003667521078170592, 0.0011736067450145895, 0.008215247215102126,
0.015479876160990712, 0.00046594944966192776, 0.00670967207513176, 0.0008051606490158112,
0.004361286848835644, 0.001166599362857271, 0.0031109316342860563, 0.001609102569458305,
0.002262800488300741, 0.0022336030626452477, 0.0015883399556588429, 0.0033531621286131126,
0.0009500626031070487, 0.007410488304234979, 0.016585581601061477, 0.00033651904697805894,
0.007066899986539238, 0.000587096306574029, 0.004579351191277426, 0.0008480279983847086,
0.003297886660384978, 0.001149837877758747, 0.002463938309483029, 0.0015328648469134054,
0.0018394378162960865, 0.0020846961918022312, 0.0013125864911347383, 0.003087703460097908,
0.000793980889739462, 0.006759567034268393, 0.018796992481203006, 0.0002403707478414707,
0.007691863930927062, 0.00043074438013191547, 0.004899717324000539, 0.0006281688876923768,
0.0035177457710773097, 0.0008491110481910748, 0.0026534720255971087, 0.0011127463333149164,
0.002034736152347276, 0.0014533829659623399, 0.0015442194013349862, 0.0019501285011144683,
0.0011143591434939818, 0.002861192395457521, 0.0006795331939211612, 0.006220342313586014,
0.023809523809523808, 0.00016345210853220007, 0.008826413860738803, 0.000311520489202546,
0.005399688479510797, 0.0004666397451429084, 0.0038108912520004186, 0.000636833286143306,
0.002865749787644877, 0.0008319918738323838, 0.0022186449968863565, 0.00106823647998232,
0.0017295257294951845, 0.0013765612949043304, 0.0013273983915148902, 0.001829657242358362,
0.0009656524334669133, 0.0026658609915368634, 0.0005924135536748585, 0.0057651953150309404,
0.045454545454545456, 9.410878976096367e-5, 0.01129305477131564, 0.0002139736693512437,
0.006258729828523879, 0.0003408894242115402, 0.0042421795012991675, 0.0004778547024451936,
0.003135921484796583, 0.0006302968741154422, 0.0024203399966032982, 0.000806779998867766,
0.001904897219548892, 0.0010219924765198817, 0.0015017032308047241, 0.0013045684437492779,
0.0011618812702142004, 0.001721967626112328, 0.0008503543832653472, 0.0024957555476324417,
0.0005241086650028127, 0.005375160959680009] 
end
